<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lupus case study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/clipboard/clipboard.min.js"></script>
<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/quarto.js"></script>
<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/popper.min.js"></script>
<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/anchor.min.js"></script>
<link href="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="240112_lupusCaseStudy_v2_parametricBootstrap_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#import-lupus-dataset" id="toc-import-lupus-dataset" class="nav-link active" data-scroll-target="#import-lupus-dataset">Import Lupus dataset</a></li>
  <li><a href="#pca-using-aitchinsons-distance" id="toc-pca-using-aitchinsons-distance" class="nav-link" data-scroll-target="#pca-using-aitchinsons-distance">PCA using Aitchinson’s distance</a>
  <ul class="collapse">
  <li><a href="#all-samples" id="toc-all-samples" class="nav-link" data-scroll-target="#all-samples">All samples</a></li>
  <li><a href="#asian-ancestry" id="toc-asian-ancestry" class="nav-link" data-scroll-target="#asian-ancestry">Asian ancestry</a></li>
  <li><a href="#european-ancestry" id="toc-european-ancestry" class="nav-link" data-scroll-target="#european-ancestry">European ancestry</a></li>
  </ul></li>
  <li><a href="#full-model" id="toc-full-model" class="nav-link" data-scroll-target="#full-model">Full model</a>
  <ul class="collapse">
  <li><a href="#asian-ancestry-1" id="toc-asian-ancestry-1" class="nav-link" data-scroll-target="#asian-ancestry-1">Asian ancestry</a>
  <ul class="collapse">
  <li><a href="#voomclr" id="toc-voomclr" class="nav-link" data-scroll-target="#voomclr">voomCLR</a></li>
  <li><a href="#differential-abundance-analysis-using-linda" id="toc-differential-abundance-analysis-using-linda" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-linda">Differential abundance analysis using LinDA</a></li>
  <li><a href="#differential-abundance-analysis-using-nb-model" id="toc-differential-abundance-analysis-using-nb-model" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-nb-model">Differential abundance analysis using NB model</a></li>
  <li><a href="#compare-methods" id="toc-compare-methods" class="nav-link" data-scroll-target="#compare-methods">Compare methods</a></li>
  </ul></li>
  <li><a href="#european-ancestry-1" id="toc-european-ancestry-1" class="nav-link" data-scroll-target="#european-ancestry-1">European ancestry</a>
  <ul class="collapse">
  <li><a href="#voomclr-1" id="toc-voomclr-1" class="nav-link" data-scroll-target="#voomclr-1">voomCLR</a></li>
  <li><a href="#differential-abundance-analysis-using-linda-1" id="toc-differential-abundance-analysis-using-linda-1" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-linda-1">Differential abundance analysis using LinDA</a></li>
  <li><a href="#differential-abundance-analysis-using-nb-model-1" id="toc-differential-abundance-analysis-using-nb-model-1" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-nb-model-1">Differential abundance analysis using NB model</a></li>
  <li><a href="#compare-methods-1" id="toc-compare-methods-1" class="nav-link" data-scroll-target="#compare-methods-1">Compare methods</a></li>
  </ul></li>
  <li><a href="#interaction-between-ancestry-and-lupus-status" id="toc-interaction-between-ancestry-and-lupus-status" class="nav-link" data-scroll-target="#interaction-between-ancestry-and-lupus-status">Interaction between ancestry and lupus status</a>
  <ul class="collapse">
  <li><a href="#voomclr-2" id="toc-voomclr-2" class="nav-link" data-scroll-target="#voomclr-2">voomCLR</a></li>
  <li><a href="#differential-abundance-analysis-using-linda-2" id="toc-differential-abundance-analysis-using-linda-2" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-linda-2">Differential abundance analysis using LinDA</a></li>
  <li><a href="#differential-abundance-analysis-using-nb-model-2" id="toc-differential-abundance-analysis-using-nb-model-2" class="nav-link" data-scroll-target="#differential-abundance-analysis-using-nb-model-2">Differential abundance analysis using NB model</a></li>
  <li><a href="#compare-methods-2" id="toc-compare-methods-2" class="nav-link" data-scroll-target="#compare-methods-2">Compare methods</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a>
  <ul class="collapse">
  <li><a href="#fraction" id="toc-fraction" class="nav-link" data-scroll-target="#fraction">Fraction</a>
  <ul class="collapse">
  <li><a href="#both-ancestries" id="toc-both-ancestries" class="nav-link" data-scroll-target="#both-ancestries">Both ancestries</a></li>
  <li><a href="#asian" id="toc-asian" class="nav-link" data-scroll-target="#asian">Asian</a></li>
  <li><a href="#european" id="toc-european" class="nav-link" data-scroll-target="#european">European</a></li>
  </ul></li>
  <li><a href="#clr" id="toc-clr" class="nav-link" data-scroll-target="#clr">CLR</a>
  <ul class="collapse">
  <li><a href="#both-ancestries-1" id="toc-both-ancestries-1" class="nav-link" data-scroll-target="#both-ancestries-1">Both ancestries</a></li>
  <li><a href="#asian-1" id="toc-asian-1" class="nav-link" data-scroll-target="#asian-1">Asian</a></li>
  <li><a href="#european-1" id="toc-european-1" class="nav-link" data-scroll-target="#european-1">European</a></li>
  </ul></li>
  <li><a href="#voomclr-within-method-heatmap" id="toc-voomclr-within-method-heatmap" class="nav-link" data-scroll-target="#voomclr-within-method-heatmap"><code>voomCLR</code> within-method heatmap</a></li>
  <li><a href="#compare-methods-3" id="toc-compare-methods-3" class="nav-link" data-scroll-target="#compare-methods-3">Compare methods</a></li>
  </ul></li>
  <li><a href="#composite-figure" id="toc-composite-figure" class="nav-link" data-scroll-target="#composite-figure">Composite figure</a></li>
  <li><a href="#not-accounting-for-processing-cohort-using-voomclr" id="toc-not-accounting-for-processing-cohort-using-voomclr" class="nav-link" data-scroll-target="#not-accounting-for-processing-cohort-using-voomclr">Not accounting for processing cohort using <code>voomCLR</code></a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lupus case study</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="import-lupus-dataset" class="level1">
<h1>Import Lupus dataset</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(limma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'limma' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(voomCLR)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>lupusCountsWide <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../data/230705_popCountsWide_individualBatchID.rds"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(lupusCountsWide<span class="sc">$</span>pop_cov) <span class="co"># paper looks at Asians and Europeans separately.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
African American            Asian         European         Hispanic 
               4              137              211                3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lupusCountsWide <span class="ot">&lt;-</span> lupusCountsWide[<span class="sc">!</span>lupusCountsWide<span class="sc">$</span>pop_cov <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"African American"</span>, <span class="st">"Hispanic"</span>),]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lupusCountsWide<span class="sc">$</span>pop_cov <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(lupusCountsWide<span class="sc">$</span>pop_cov)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>lupusCountMatAll <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(lupusCountsWide[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)]))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>lupusMetaAll <span class="ot">&lt;-</span> lupusCountsWide[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Asian data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>lupusCountsWideAsian <span class="ot">&lt;-</span> lupusCountsWide[lupusCountsWide<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"Asian"</span>,]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>lupusCountMatAsian <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(lupusCountsWideAsian[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)]))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>lupusMetaAsian <span class="ot">&lt;-</span> lupusCountsWideAsian[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="do">## European data</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>lupusCountsWideEuropean <span class="ot">&lt;-</span> lupusCountsWide[lupusCountsWide<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"European"</span>,]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>lupusCountMatEuropean <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(lupusCountsWideEuropean[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)]))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>lupusMetaEuropean <span class="ot">&lt;-</span> lupusCountsWideEuropean[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pca-using-aitchinsons-distance" class="level1">
<h1>PCA using Aitchinson’s distance</h1>
<section id="all-samples" class="level2">
<h2 class="anchored" data-anchor-id="all-samples">All samples</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>designAll <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status<span class="sc">*</span>pop_cov <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaAll)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>lupusCLRMatAll <span class="ot">&lt;-</span> v<span class="sc">$</span>E</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scater)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'scater' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SingleCellExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'SingleCellExperiment' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SummarizedExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'GenomicRanges' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:limma':

    plotMA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, aperm, append, as.data.frame, basename, cbind,
    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
    get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,
    match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,
    Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,
    table, tapply, union, unique, unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'S4Vectors' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomeInfoDb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'GenomeInfoDb' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: scuttle</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'scuttle' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scater'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:limma':

    plotMDS</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">calculatePCA</span>(lupusCLRMatAll,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncomponents=</span><span class="dv">2</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ntop=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: useNames = NA is deprecated. Instead, specify either useNames = TRUE
or useNames = TRUE.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dfPCA <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">pc1=</span>pc[,<span class="dv">1</span>], <span class="at">pc2=</span>pc[,<span class="dv">2</span>]), lupusMetaAll)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dfPCA<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfPCA<span class="sc">$</span>Age)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>group)) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Age)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Sex)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## technical variables</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>pBatch <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>batch_cov)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">5</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>pCohort <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Processing_Cohort)) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">2</span>))</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>dfPCA<span class="sc">$</span>nCells <span class="ot">&lt;-</span> <span class="fu">colSums</span>(lupusCountMatAll)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>pnCells <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>nCells)) <span class="sc">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>() <span class="sc">+</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>))<span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>))</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>pTechnicalPCA <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pBatch, pCohort, pnCells,</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">nrow=</span><span class="dv">1</span>, <span class="at">labels=</span>letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>pTechnicalPCA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-2-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/230913_lupusCase_PCATechnical.pdf"</span>, <span class="at">width=</span><span class="dv">19</span>, <span class="at">height=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="asian-ancestry" class="level2">
<h2 class="anchored" data-anchor-id="asian-ancestry">Asian ancestry</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>designAsian <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaAsian)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAsian,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAsian,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lupusCLRMatAsian <span class="ot">&lt;-</span> v<span class="sc">$</span>E</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scater)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">calculatePCA</span>(lupusCLRMatAsian,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncomponents=</span><span class="dv">2</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ntop=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: useNames = NA is deprecated. Instead, specify either useNames = TRUE
or useNames = TRUE.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dfPCA <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">pc1=</span>pc[,<span class="dv">1</span>], <span class="at">pc2=</span>pc[,<span class="dv">2</span>]), lupusMetaAsian)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>dfPCA<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfPCA<span class="sc">$</span>Age)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>group)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>batch_cov)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Age)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Sex)) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Processing_Cohort)) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-3-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="european-ancestry" class="level2">
<h2 class="anchored" data-anchor-id="european-ancestry">European ancestry</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>designEuropean <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaEuropean)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatEuropean,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designEuropean,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>lupusCLRMatEuropean <span class="ot">&lt;-</span> v<span class="sc">$</span>E</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scater)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">calculatePCA</span>(lupusCLRMatEuropean,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncomponents=</span><span class="dv">2</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ntop=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: useNames = NA is deprecated. Instead, specify either useNames = TRUE
or useNames = TRUE.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dfPCA <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">pc1=</span>pc[,<span class="dv">1</span>], <span class="at">pc2=</span>pc[,<span class="dv">2</span>]), lupusMetaEuropean)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>dfPCA<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfPCA<span class="sc">$</span>Age)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>group)) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>batch_cov)) <span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Age)) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Sex)) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>Processing_Cohort)) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-4-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="full-model" class="level1">
<h1>Full model</h1>
<section id="asian-ancestry-1" class="level2">
<h2 class="anchored" data-anchor-id="asian-ancestry-1">Asian ancestry</h2>
<section id="voomclr" class="level3">
<h3 class="anchored" data-anchor-id="voomclr">voomCLR</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">table</span>(<span class="fu">droplevels</span>(lupusMetaAll<span class="sc">$</span>ind_cov))) <span class="co"># 49+14+5=68 samples constituting 92 replicates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4 
188  49  14   5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>patientAll <span class="ot">&lt;-</span> lupusMetaAll<span class="sc">$</span>ind_cov</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>designAll <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status<span class="sc">*</span>pop_cov <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaAll)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus, </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plotBeta</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-5-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">eBayes</span>(fit)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tt &lt;- topTableBC(fit, coef="SLE_statusSLE", number=Inf, bootstrap="nonparametric") </span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">topTableBC</span>(fit, <span class="at">coef=</span><span class="st">"SLE_statusSLE"</span>, <span class="at">number=</span><span class="cn">Inf</span>, <span class="at">bootstrap=</span><span class="st">"parametric"</span>, <span class="at">voomWeights=</span>v<span class="sc">$</span>weights) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'httr':
  method         from  
  print.response rmutil</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             logFC    AveExpr          t      P.Value    adj.P.Val
cM      0.86992102  2.4003730  5.9468411 6.550248e-09 7.205273e-08
Prolif  0.96398129 -1.3857294  5.1787396 3.752386e-07 2.063812e-06
ncM     0.68320271  0.4813234  3.8948689 1.174161e-04 4.305259e-04
T8      0.35806794  2.2140739  2.2920937 2.248536e-02 6.183475e-02
T4     -0.29667284  2.6602609 -2.0555609 4.055644e-02 8.922416e-02
pDC    -0.05930883 -1.7545140 -0.3955859 6.926484e-01 8.836304e-01
cDC     0.04535097 -0.4424735  0.3468664 7.288974e-01 8.836304e-01
B       0.05691277  1.5533677  0.3022697 7.626237e-01 8.836304e-01
Progen -0.04723743 -3.5267006 -0.2692360 7.879046e-01 8.836304e-01
NK      0.04015471  1.0854200  0.2492646 8.033003e-01 8.836304e-01
PB     -0.02288752 -3.2854013 -0.1162542 9.075168e-01 9.075168e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>ttAsian <span class="ot">&lt;-</span> tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="differential-abundance-analysis-using-linda" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-linda">Differential abundance analysis using LinDA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## linda</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MicrobiomeStat)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'phyloseq' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'phyloseq'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:SummarizedExperiment':

    distance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Biobase':

    sampleNames</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:GenomicRanges':

    distance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:IRanges':

    distance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>lindaRes <span class="ot">&lt;-</span> LinDA<span class="sc">::</span><span class="fu">linda</span>(<span class="at">otu.tab =</span> lupusCountMatAll, <span class="co"># rows features, cols samples</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">meta =</span> <span class="fu">as.data.frame</span>(lupusMetaAll),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">formula =</span> <span class="st">'~SLE_status*pop_cov + Processing_Cohort + (1|ind_cov)'</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">'count'</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">imputation =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Imputation approach is used.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE[<span class="fu">order</span>(<span class="fu">abs</span>(lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE<span class="sc">$</span>stat), <span class="at">decreasing=</span><span class="cn">TRUE</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          baseMean log2FoldChange     lfcSE         stat       pvalue
cM     170088.3906   1.1363311657 0.1639862  6.929429760 2.614165e-11
Prolif   4127.1709   1.3286318811 0.2378555  5.585878253 5.340039e-08
ncM     27885.9356   0.9608920680 0.2165696  4.436874839 1.286150e-05
T4     334833.8531  -0.5043792921 0.1661191 -3.036251465 2.624528e-03
T8     225106.2464   0.4793758359 0.1829425  2.620363944 9.260399e-03
pDC      3785.8124  -0.0850135706 0.2307608 -0.368405568 7.128425e-01
NK      69831.9308  -0.0596122904 0.2635841 -0.226160383 8.212326e-01
PB        701.9827   0.0777134048 0.3500090  0.222032570 8.244413e-01
cDC     14138.9751   0.0421713853 0.2058548  0.204859898 8.378285e-01
B      149010.2159   0.0031493904 0.3222671  0.009772608 9.922092e-01
Progen    489.4865  -0.0005371213 0.2603230 -0.002063288 9.983552e-01
               padj reject       df
cM     2.875582e-10   TRUE 298.0531
Prolif 2.937022e-07   TRUE 290.9499
ncM    4.715884e-05   TRUE 297.9140
T4     7.217453e-03   TRUE 275.7412
T8     2.037288e-02   TRUE 281.5456
pDC    9.983552e-01  FALSE 286.9459
NK     9.983552e-01  FALSE 296.3583
PB     9.983552e-01  FALSE 296.5845
cDC    9.983552e-01  FALSE 283.6023
B      9.983552e-01  FALSE 299.1814
Progen 9.983552e-01  FALSE 288.0931</code></pre>
</div>
</div>
</section>
<section id="differential-abundance-analysis-using-nb-model" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-nb-model">Differential abundance analysis using NB model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>resDfNB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population=</span><span class="fu">rownames</span>(lupusCountMatAll),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">diff=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pval=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)))</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lupusCountMatAll)){</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  curY <span class="ot">&lt;-</span> lupusCountMatAll[pp,]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  m_p <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(curY <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> designAll <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>patientAll), </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family=</span><span class="fu">nbinom2</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">offset =</span> <span class="fu">log</span>(<span class="fu">colSums</span>(lupusCountMatAll)))</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  resDfNB[pp,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">summary</span>(m_p)<span class="sc">$</span>coef<span class="sc">$</span>cond[<span class="st">"designAllSLE_statusSLE"</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>)])</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>resDfNB<span class="sc">$</span>padj <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(resDfNB<span class="sc">$</span>pval, <span class="st">"fdr"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>resDfNB[<span class="fu">order</span>(<span class="fu">abs</span>(resDfNB<span class="sc">$</span>pval)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   population         diff         se         pval         padj
5          T4 -0.572844163 0.09151478 3.860139e-10 4.246153e-09
8          cM  0.540788207 0.10060105 7.633992e-08 4.198696e-07
4      Prolif  0.753422035 0.17840592 2.409888e-05 8.836257e-05
9         ncM  0.367463012 0.14825585 1.319089e-02 3.627496e-02
10        pDC -0.328795240 0.16159324 4.188015e-02 9.213633e-02
3      Progen -0.374133398 0.21399433 8.040634e-02 1.474116e-01
7         cDC -0.202719933 0.13230938 1.254815e-01 1.971852e-01
2          NK -0.228314552 0.17430468 1.902435e-01 2.615849e-01
6          T8  0.106458010 0.10352131 3.037767e-01 3.712826e-01
11         PB -0.144220205 0.28632108 6.144715e-01 6.759187e-01
1           B  0.005569724 0.15837465 9.719458e-01 9.719458e-01</code></pre>
</div>
</div>
</section>
<section id="compare-methods" class="level3">
<h3 class="anchored" data-anchor-id="compare-methods">Compare methods</h3>
<section id="fdr-5" class="level4">
<h4 class="anchored" data-anchor-id="fdr-5">FDR 5%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE[allPopulations,]<span class="sc">$</span>log2FoldChange,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE[allPopulations,]<span class="sc">$</span>padj,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.05</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>daResAsian <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>pCompFullAsian <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>pCompFullAsian</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fdr-10" class="level4">
<h4 class="anchored" data-anchor-id="fdr-10">FDR 10%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE[allPopulations,]<span class="sc">$</span>log2FoldChange,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE[allPopulations,]<span class="sc">$</span>padj,</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>daResAsian <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>pCompFullAsian <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>pCompFullAsian</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="european-ancestry-1" class="level2">
<h2 class="anchored" data-anchor-id="european-ancestry-1">European ancestry</h2>
<section id="voomclr-1" class="level3">
<h3 class="anchored" data-anchor-id="voomclr-1">voomCLR</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>patientAll <span class="ot">&lt;-</span> lupusMetaAll<span class="sc">$</span>ind_cov</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>designAll <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status<span class="sc">*</span>pop_cov <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaAll)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus, </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span><span class="fu">ncol</span>(fit<span class="sc">$</span>coefficients), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(L) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(fit<span class="sc">$</span>coefficients)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>L[<span class="fu">c</span>(<span class="st">"SLE_statusSLE"</span>, <span class="st">"SLE_statusSLE:pop_covEuropean"</span>),<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>conFit <span class="ot">&lt;-</span> <span class="fu">contrasts.fit</span>(fit,</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contrasts =</span> L)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plotBeta</span>(conFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>conFit <span class="ot">&lt;-</span> <span class="fu">eBayes</span>(conFit)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tt &lt;- topTableBC(conFit, number=Inf, coef=1, bootstrap="nonparametric") </span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">topTableBC</span>(conFit, <span class="at">coef=</span><span class="dv">1</span>, <span class="at">number=</span><span class="cn">Inf</span>, </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bootstrap=</span><span class="st">"parametric"</span>, <span class="at">voomWeights=</span>v<span class="sc">$</span>weights, <span class="at">contrastMatrix=</span>L) </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             logFC    AveExpr           t      P.Value    adj.P.Val
cM      0.68010970  2.4003730  4.62487445 5.259796e-06 5.785776e-05
Prolif  0.72483470 -1.3857294  4.27759741 2.432634e-05 1.337948e-04
ncM     0.52694715  0.4813234  3.25790483 1.230782e-03 4.512869e-03
pDC    -0.48951631 -1.7545140 -2.95415991 3.344476e-03 9.197310e-03
T8      0.25630666  2.2140739  1.83738134 6.698992e-02 1.473778e-01
B      -0.30856189  1.5533677 -1.57643913 1.158160e-01 2.123293e-01
Progen  0.15660126 -3.5267006  1.10828287 2.684905e-01 4.040487e-01
PB     -0.19326064 -3.2854013 -1.05126271 2.938536e-01 4.040487e-01
NK      0.11126957  1.0854200  0.90286945 3.672079e-01 4.487842e-01
T4     -0.10942967  2.6602609 -0.82842715 4.079857e-01 4.487842e-01
cDC    -0.00340279 -0.4424735 -0.02825823 9.774721e-01 9.774721e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>ttEuropean <span class="ot">&lt;-</span> tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="differential-abundance-analysis-using-linda-1" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-linda-1">Differential abundance analysis using LinDA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="do">## linda</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(MicrobiomeStat)</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LinDA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'LinDA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:MicrobiomeStat':

    linda, linda.plot</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>lindaRes <span class="ot">&lt;-</span> LinDA<span class="sc">::</span><span class="fu">linda</span>(<span class="at">otu.tab =</span> lupusCountMatAll, <span class="co"># rows features, cols samples</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">meta =</span> <span class="fu">as.data.frame</span>(lupusMetaAll),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">formula =</span> <span class="st">'~SLE_status*pop_cov + Processing_Cohort + (1|ind_cov)'</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">'count'</span>,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">imputation =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Imputation approach is used.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="do">## code from developers on GitHub</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>alp1 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE<span class="sc">$</span>log2FoldChange</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>se1 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE<span class="sc">$</span>lfcSE</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE<span class="sc">$</span>df</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>alp3 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span><span class="sc">$</span>log2FoldChange</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>se3 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span><span class="sc">$</span>lfcSE</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span><span class="sc">$</span>df</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>cov13 <span class="ot">&lt;-</span> lindaRes<span class="sc">$</span>covariance<span class="sc">$</span>SLE_statusSLE<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>stat_linDA <span class="ot">&lt;-</span> (alp1<span class="sc">+</span>alp3) <span class="sc">/</span> (<span class="fu">sqrt</span>(se1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>se3<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>cov13))</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>l2fc_linDA <span class="ot">&lt;-</span> alp1<span class="sc">+</span>alp3</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(stat_linDA) <span class="ot">&lt;-</span> <span class="fu">names</span>(l2fc_linDA) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lindaRes<span class="sc">$</span>output<span class="sc">$</span>SLE_statusSLE)</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>pvalue_linDA <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(stat_linDA), (df1<span class="sc">+</span>df3)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>padj_linDA <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pvalue_linDA, <span class="at">method =</span> <span class="st">'BH'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="differential-abundance-analysis-using-nb-model-1" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-nb-model-1">Differential abundance analysis using NB model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: TH.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'TH.data'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    geyser</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>resDfNB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population=</span><span class="fu">rownames</span>(lupusCountMatAll),</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">diff=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pval=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lupusCountMatAll)){</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  curY <span class="ot">&lt;-</span> lupusCountMatAll[pp,]</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  m_p <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(curY <span class="sc">~</span> SLE_status<span class="sc">*</span>pop_cov <span class="sc">+</span> Processing_Cohort <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ind_cov), </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>lupusMetaAll,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family=</span><span class="fu">nbinom2</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">offset =</span> <span class="fu">log</span>(<span class="fu">colSums</span>(lupusCountMatAll)))</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## contrast</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span><span class="fu">nrow</span>(<span class="fu">summary</span>(m_p)<span class="sc">$</span>coef<span class="sc">$</span>cond), <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(L) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">summary</span>(m_p)<span class="sc">$</span>coef<span class="sc">$</span>cond)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>  L[<span class="fu">c</span>(<span class="st">"SLE_statusSLE"</span>, <span class="st">"SLE_statusSLE:pop_covEuropean"</span>),<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>  m_p_contrast <span class="ot">&lt;-</span> <span class="fu">glht</span>(m_p, </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">linfct=</span><span class="fu">t</span>(L),</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">coef. =</span> <span class="cf">function</span>(x) <span class="fu">fixef</span>(x)[[<span class="st">"cond"</span>]],</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">vcov. =</span> <span class="cf">function</span>(x) <span class="fu">vcov</span>(x)[[<span class="st">"cond"</span>]],</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">df=</span><span class="cn">NULL</span>)</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    resDfNB[pp,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">summary</span>(m_p_contrast)<span class="sc">$</span>test<span class="sc">$</span>coefficients, </span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">summary</span>(m_p_contrast)<span class="sc">$</span>test<span class="sc">$</span>sigma,</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">summary</span>(m_p_contrast)<span class="sc">$</span>test<span class="sc">$</span>pvalues)</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>resDfNB<span class="sc">$</span>padj <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(resDfNB<span class="sc">$</span>pval, <span class="st">"fdr"</span>)</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>resDfNB[<span class="fu">order</span>(<span class="fu">abs</span>(resDfNB<span class="sc">$</span>pval)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   population        diff         se         pval         padj
10        pDC -0.68385850 0.10983585 4.779253e-10 5.257178e-09
8          cM  0.41418418 0.07197234 8.676045e-09 4.771825e-08
5          T4 -0.35526597 0.06539384 5.550349e-08 2.035128e-07
4      Prolif  0.54850403 0.12751103 1.695536e-05 4.662725e-05
9         ncM  0.34151231 0.10429513 1.058566e-03 2.328846e-03
7         cDC -0.20689648 0.09318096 2.639347e-02 4.838802e-02
11         PB -0.33038836 0.21819957 1.299861e-01 2.042639e-01
1           B -0.14732455 0.10909022 1.768609e-01 2.431838e-01
6          T8 -0.06158321 0.07365516 4.030977e-01 4.926749e-01
2          NK -0.09121741 0.12376636 4.611145e-01 5.072259e-01
3      Progen -0.08643978 0.15918021 5.871085e-01 5.871085e-01</code></pre>
</div>
</div>
</section>
<section id="compare-methods-1" class="level3">
<h3 class="anchored" data-anchor-id="compare-methods-1">Compare methods</h3>
<section id="fdr-5-1" class="level4">
<h4 class="anchored" data-anchor-id="fdr-5-1">FDR 5%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>                                      l2fc_linDA[allPopulations],</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>                                      padj_linDA[allPopulations],</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.05</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>daResEuropean <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>pCompFullEuropean <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>pCompFullEuropean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fdr-10-1" class="level4">
<h4 class="anchored" data-anchor-id="fdr-10-1">FDR 10%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>                                      l2fc_linDA[allPopulations],</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>                                      padj_linDA[allPopulations],</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>daResEuropean <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>pCompFullEuropean <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>pCompFullEuropean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="interaction-between-ancestry-and-lupus-status" class="level2">
<h2 class="anchored" data-anchor-id="interaction-between-ancestry-and-lupus-status">Interaction between ancestry and lupus status</h2>
<section id="voomclr-2" class="level3">
<h3 class="anchored" data-anchor-id="voomclr-2">voomCLR</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>patientAll <span class="ot">&lt;-</span> lupusMetaAll<span class="sc">$</span>ind_cov</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>designAll <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status<span class="sc">*</span>pop_cov <span class="sc">+</span> Processing_Cohort, <span class="at">data=</span>lupusMetaAll)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus, </span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll,</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus)</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll)</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plotBeta</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-15-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">eBayes</span>(fit)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tt &lt;- topTableBC(fit, coef="SLE_statusSLE:pop_covEuropean", number=Inf, bootstrap="nonparametric") </span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">topTableBC</span>(fit, <span class="at">coef=</span><span class="st">"SLE_statusSLE:pop_covEuropean"</span>, <span class="at">number=</span><span class="cn">Inf</span>, </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bootstrap=</span><span class="st">"parametric"</span>, <span class="at">voomWeights=</span>v<span class="sc">$</span>weights) </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              logFC    AveExpr           t    P.Value adj.P.Val
T4      0.346673025  2.6602609  1.94047072 0.05311457 0.5842603
Progen  0.363268557 -3.5267006  1.43662803 0.15170508 0.7566332
pDC    -0.270777620 -1.7545140 -1.26597031 0.20635450 0.7566332
NK      0.230544724  1.0854200  1.05397054 0.29261377 0.8046879
B      -0.206044798  1.5533677 -0.78499770 0.43297887 0.9525535
cDC     0.110676105 -0.4424735  0.64342221 0.52036591 0.9540042
Prolif -0.079716727 -1.3857294 -0.38388005 0.70129735 0.9784074
T8      0.057668578  2.2140739  0.37004601 0.71156904 0.9784074
cM     -0.030381458  2.4003730 -0.19752691 0.84352837 0.9852866
PB     -0.010943257 -3.2854013 -0.04157695 0.96685934 0.9852866
ncM     0.003174309  0.4813234  0.01845454 0.98528662 0.9852866</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>ttInteraction <span class="ot">&lt;-</span> tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="differential-abundance-analysis-using-linda-2" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-linda-2">Differential abundance analysis using LinDA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="do">## linda</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MicrobiomeStat)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>lindaRes <span class="ot">&lt;-</span> LinDA<span class="sc">::</span><span class="fu">linda</span>(<span class="at">otu.tab =</span> lupusCountMatAll, <span class="co"># rows features, cols samples</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">meta =</span> <span class="fu">as.data.frame</span>(lupusMetaAll),</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">formula =</span> <span class="st">'~SLE_status*pop_cov + Processing_Cohort + (1|ind_cov)'</span>,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">'count'</span>,</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">imputation =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Imputation approach is used.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span>[<span class="fu">order</span>(<span class="fu">abs</span>(lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span><span class="sc">$</span>stat), <span class="at">decreasing=</span><span class="cn">TRUE</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          baseMean log2FoldChange     lfcSE        stat      pvalue      padj
T4     334833.8531    0.529961915 0.2018866  2.62504735 0.009161057 0.1007716
pDC      3785.8124   -0.429555526 0.2806005 -1.53084374 0.126933994 0.4762756
Progen    489.4865    0.465057080 0.3149329  1.47668623 0.140889879 0.4762756
NK      69831.9308    0.437485362 0.3204147  1.36537233 0.173191129 0.4762756
cDC     14138.9751    0.160464921 0.2503377  0.64099376 0.522056353 0.9849323
B      149010.2159   -0.199601528 0.3908179 -0.51072767 0.609926934 0.9849323
Prolif   4127.1709   -0.042135589 0.2890066 -0.14579453 0.884186808 0.9849323
PB        701.9827    0.046532899 0.4238971  0.10977404 0.912664812 0.9849323
T8     225106.2464   -0.017920869 0.2229997 -0.08036274 0.936006781 0.9849323
cM     170088.3906    0.005947780 0.1989946  0.02988915 0.976175903 0.9849323
ncM     27885.9356   -0.004974189 0.2631593 -0.01890182 0.984932323 0.9849323
       reject       df
T4      FALSE 268.1015
pDC     FALSE 280.7487
Progen  FALSE 278.4290
NK      FALSE 290.8498
cDC     FALSE 277.1801
B       FALSE 292.5512
Prolif  FALSE 284.5752
PB      FALSE 288.8260
T8      FALSE 277.0387
cM      FALSE 291.6474
ncM     FALSE 292.3160</code></pre>
</div>
</div>
</section>
<section id="differential-abundance-analysis-using-nb-model-2" class="level3">
<h3 class="anchored" data-anchor-id="differential-abundance-analysis-using-nb-model-2">Differential abundance analysis using NB model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>resDfNB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population=</span><span class="fu">rownames</span>(lupusCountMatAll),</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">diff=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)),</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pval=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">nrow</span>(lupusCountMatAll)))</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lupusCountMatAll)){</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  curY <span class="ot">&lt;-</span> lupusCountMatAll[pp,]</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  m_p <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(curY <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> designAll <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>patientAll), </span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family=</span><span class="fu">nbinom2</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">offset =</span> <span class="fu">log</span>(<span class="fu">colSums</span>(lupusCountMatAll)))</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  resDfNB[pp,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">summary</span>(m_p)<span class="sc">$</span>coef<span class="sc">$</span>cond[<span class="st">"designAllSLE_statusSLE:pop_covEuropean"</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>)])</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended

Warning in glmmTMB(curY ~ -1 + designAll + (1 | patientAll), family =
nbinom2(link = "log"), : use of the 'data' argument is recommended</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>resDfNB<span class="sc">$</span>padj <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(resDfNB<span class="sc">$</span>pval, <span class="st">"fdr"</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>resDfNB[<span class="fu">order</span>(<span class="fu">abs</span>(resDfNB<span class="sc">$</span>pval)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   population         diff        se       pval      padj
5          T4  0.217578193 0.1116804 0.05138836 0.3704130
10        pDC -0.355063264 0.1940930 0.06734782 0.3704130
6          T8 -0.168041216 0.1266046 0.18441209 0.6321883
3      Progen  0.287693616 0.2605178 0.26945663 0.6321883
8          cM -0.126604031 0.1222312 0.30030697 0.6321883
4      Prolif -0.204918000 0.2169214 0.34482997 0.6321883
1           B -0.152894279 0.1887473 0.41791286 0.6567202
2          NK  0.137097146 0.2108877 0.51563059 0.7089921
11         PB -0.186168152 0.3548917 0.59987698 0.7331830
9         ncM -0.025950701 0.1804912 0.88567563 0.9742432
7         cDC -0.004176542 0.1605015 0.97923993 0.9792399</code></pre>
</div>
</div>
</section>
<section id="compare-methods-2" class="level3">
<h3 class="anchored" data-anchor-id="compare-methods-2">Compare methods</h3>
<section id="fdr-5-2" class="level4">
<h4 class="anchored" data-anchor-id="fdr-5-2">FDR 5%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span>[allPopulations,]<span class="sc">$</span>log2FoldChange,</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span>[allPopulations,]<span class="sc">$</span>padj,</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.05</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>daResInteraction <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>pCompInteraction <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>pCompInteraction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fdr-10-2" class="level4">
<h4 class="anchored" data-anchor-id="fdr-10-2">FDR 10%</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>allPopulations <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lupusCountMatAll)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>nPopulations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(lupusCountMatAll)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>allMethods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"voomCLR"</span>, <span class="st">"LinDA"</span>, <span class="st">"NBGLM"</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>nMethods <span class="ot">&lt;-</span> <span class="fu">length</span>(allMethods)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">rep</span>(allPopulations, nMethods),</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">rep</span>(allMethods, <span class="at">each=</span>nPopulations),</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>logFC,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span>[allPopulations,]<span class="sc">$</span>log2FoldChange,</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log2</span>(<span class="fu">exp</span>(resDfNB<span class="sc">$</span>diff))),</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">c</span>(tt[allPopulations,]<span class="sc">$</span>adj.P.Val,</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>                                      lindaRes<span class="sc">$</span>output<span class="sc">$</span><span class="st">`</span><span class="at">SLE_statusSLE:pop_covEuropean</span><span class="st">`</span>[allPopulations,]<span class="sc">$</span>padj,</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>                                      resDfNB<span class="sc">$</span>padj)</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>daResInteraction <span class="ot">&lt;-</span> resDfAll</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>pCompInteraction <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>population, <span class="at">y=</span>method, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>population, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>pCompInteraction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pCompFullAsian, pCompFullEuropean, pCompInteraction, </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol=</span><span class="dv">1</span>, <span class="at">labels=</span>letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.
Using size for a discrete variable is not advised.
Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/240112_lupusCase_allContrasts_parametricBootstrap_fdr10.pdf"</span>, <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="visualization" class="level1 tabset tabset-pills">
<h1 class="tabset tabset-pills">Visualization</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ lubridate 1.9.3     ✔ tibble    3.2.1
✔ purrr     1.0.2     ✔ tidyr     1.3.0
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ lubridate::%within%() masks IRanges::%within%()
✖ dplyr::collapse()     masks IRanges::collapse()
✖ dplyr::combine()      masks Biobase::combine(), BiocGenerics::combine()
✖ dplyr::count()        masks matrixStats::count()
✖ dplyr::desc()         masks IRanges::desc()
✖ tidyr::expand()       masks S4Vectors::expand()
✖ dplyr::filter()       masks stats::filter()
✖ dplyr::first()        masks S4Vectors::first()
✖ dplyr::lag()          masks stats::lag()
✖ ggplot2::Position()   masks BiocGenerics::Position(), base::Position()
✖ purrr::reduce()       masks GenomicRanges::reduce(), IRanges::reduce()
✖ dplyr::rename()       masks S4Vectors::rename()
✖ lubridate::second()   masks S4Vectors::second()
✖ lubridate::second&lt;-() masks S4Vectors::second&lt;-()
✖ dplyr::select()       masks MASS::select()
✖ dplyr::slice()        masks IRanges::slice()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>lupusCountsLong <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../data/230705_popCountsLong_individualBatchID.rds"</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>lupusCountsLong <span class="ot">&lt;-</span> lupusCountsLong[lupusCountsLong<span class="sc">$</span>pop_cov <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Asian"</span>, <span class="st">"European"</span>),]</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>lupusCountsLong <span class="ot">&lt;-</span> lupusCountsLong <span class="sc">%&gt;%</span> </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient, group) <span class="sc">%&gt;%</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">totalCells =</span> <span class="fu">sum</span>(nCells),</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nCellTypes =</span> <span class="fu">n</span>(),</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">geoMean =</span> <span class="fu">prod</span>(nCells<span class="sc">+</span><span class="dv">1</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>nCellTypes),</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">CLR =</span> <span class="fu">log</span>((nCells<span class="sc">+</span><span class="dv">1</span>) <span class="sc">/</span> geoMean )) <span class="sc">%&gt;%</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fractionCells =</span> nCells <span class="sc">/</span> totalCells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="fraction" class="level2 tabset tabset-pills">
<h2 class="tabset tabset-pills anchored" data-anchor-id="fraction">Fraction</h2>
<section id="both-ancestries" class="level3">
<h3 class="anchored" data-anchor-id="both-ancestries">Both ancestries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong, <span class="fu">aes</span>(<span class="at">x=</span>celltype, <span class="at">y=</span>fractionCells, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="asian" class="level3">
<h3 class="anchored" data-anchor-id="asian">Asian</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong[lupusCountsLong<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"Asian"</span>,], <span class="fu">aes</span>(<span class="at">x=</span>celltype, <span class="at">y=</span>fractionCells, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Asian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="european" class="level3">
<h3 class="anchored" data-anchor-id="european">European</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong[lupusCountsLong<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"European"</span>,], <span class="fu">aes</span>(<span class="at">x=</span>celltype, <span class="at">y=</span>fractionCells, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"European"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="clr" class="level2 tabset tabset-pills">
<h2 class="tabset tabset-pills anchored" data-anchor-id="clr">CLR</h2>
<section id="both-ancestries-1" class="level3">
<h3 class="anchored" data-anchor-id="both-ancestries-1">Both ancestries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong, <span class="fu">aes</span>(<span class="at">x=</span>CLR, <span class="at">y=</span>celltype, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>pop_cov) <span class="sc">+</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/230822_lupusCase_clrBoxplots.pdf"</span>, </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">8</span>, <span class="at">height=</span><span class="dv">10</span>)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong, <span class="fu">aes</span>(<span class="at">x=</span>CLR, <span class="at">y=</span>celltype, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">9</span>), <span class="at">col=</span><span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha=</span>.<span class="dv">3</span>), <span class="at">size=</span>.<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>pop_cov) <span class="sc">+</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/230822_lupusCase_clrViolinplots.pdf"</span>, </span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">8</span>, <span class="at">height=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="asian-1" class="level3">
<h3 class="anchored" data-anchor-id="asian-1">Asian</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong[lupusCountsLong<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"Asian"</span>,], <span class="fu">aes</span>(<span class="at">x=</span>celltype, <span class="at">y=</span>CLR, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Asian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="european-1" class="level3">
<h3 class="anchored" data-anchor-id="european-1">European</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lupusCountsLong[lupusCountsLong<span class="sc">$</span>pop_cov <span class="sc">==</span> <span class="st">"European"</span>,], <span class="fu">aes</span>(<span class="at">x=</span>celltype, <span class="at">y=</span>CLR, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"European"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="voomclr-within-method-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="voomclr-within-method-heatmap"><code>voomCLR</code> within-method heatmap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>ttAll <span class="ot">&lt;-</span> <span class="fu">list</span>(ttAsian, ttEuropean, ttInteraction)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttAll, rownames)),</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">contrast =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Asian"</span>, <span class="st">"European"</span>, <span class="st">"Interaction"</span>), <span class="at">each=</span>nPopulations),</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttAll, <span class="cf">function</span>(x) x<span class="sc">$</span>logFC)),</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttAll, <span class="cf">function</span>(x) x<span class="sc">$</span>adj.P.Val))</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>pHeatVoomCLR <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>contrast, <span class="at">y=</span>population, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Contrast"</span>) <span class="sc">+</span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cell type"</span>)</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>pHeatVoomCLR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="compare-methods-3" class="level2">
<h2 class="anchored" data-anchor-id="compare-methods-3">Compare methods</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="do">## upset for all contrasts: how often do methods agree in calling DA?</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UpSetR)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>daResAsian<span class="sc">$</span>comparison <span class="ot">&lt;-</span> <span class="st">"Asian"</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>daResEuropean<span class="sc">$</span>comparison <span class="ot">&lt;-</span> <span class="st">"European"</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>daResInteraction<span class="sc">$</span>comparison <span class="ot">&lt;-</span> <span class="st">"Interaction"</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>daResAllComp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(daResAsian, daResEuropean, daResInteraction)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>daResAllComp<span class="sc">$</span>popDA <span class="ot">&lt;-</span> <span class="fu">paste0</span>(daResAllComp<span class="sc">$</span>population,<span class="st">"_"</span>,daResAllComp<span class="sc">$</span>comparison,<span class="st">"_"</span>,daResAllComp<span class="sc">$</span>DA)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>daListAllComp <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"LinDA"</span><span class="ot">=</span>daResAllComp<span class="sc">$</span>popDA[daResAllComp<span class="sc">$</span>method <span class="sc">==</span> <span class="st">"LinDA"</span>],</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"NBGLM"</span><span class="ot">=</span>daResAllComp<span class="sc">$</span>popDA[daResAllComp<span class="sc">$</span>method <span class="sc">==</span> <span class="st">"NBGLM"</span>],</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"voomCLR"</span><span class="ot">=</span>daResAllComp<span class="sc">$</span>popDA[daResAllComp<span class="sc">$</span>method <span class="sc">==</span> <span class="st">"voomCLR"</span>])</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"../plots/230913_lupusCase_upsetBtwnMethods.pdf"</span>, <span class="at">width=</span><span class="dv">8</span>, <span class="at">height=</span><span class="dv">8</span>)</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="fu">upset</span>(<span class="fu">fromList</span>(daListAllComp), <span class="at">order.by=</span><span class="st">"freq"</span>)</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="do">## rank difference</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>daResAllComp <span class="ot">&lt;-</span> daResAllComp <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(method, comparison) <span class="sc">%&gt;%</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(padj)) <span class="sc">%&gt;%</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>daResAllComp_rankDiff <span class="ot">&lt;-</span> daResAllComp <span class="sc">%&gt;%</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(comparison, population) <span class="sc">%&gt;%</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(method) <span class="sc">%&gt;%</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">diffRank =</span> <span class="fu">combn</span>(rank,<span class="dv">2</span>,diff),</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">test =</span> <span class="fu">combn</span>(method,<span class="dv">2</span>,paste, <span class="at">simplify =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">test2=</span><span class="fu">unlist</span>(<span class="fu">lapply</span>(test, <span class="cf">function</span>(x) <span class="fu">paste</span>(x,<span class="at">collapse=</span><span class="st">"-"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'comparison', 'population'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(daResAllComp_rankDiff, <span class="fu">aes</span>(<span class="at">x=</span>test2, <span class="at">y=</span>diffRank)) <span class="sc">+</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="dv">0</span>, <span class="at">width=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pairwise difference"</span>) <span class="sc">+</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in rank"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add avg count</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>avCount <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population=</span><span class="fu">rownames</span>(lupusCountMatAll),</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">avCount=</span><span class="fu">rowMeans</span>(lupusCLRMatAll))</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>daResAllComp_rankDiff <span class="ot">&lt;-</span> <span class="fu">merge</span>(daResAllComp_rankDiff, avCount)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(daResAllComp_rankDiff, <span class="fu">aes</span>(<span class="at">x=</span>test2, <span class="at">y=</span>diffRank)) <span class="sc">+</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="dv">0</span>, <span class="at">width=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Pairwise difference"</span>) <span class="sc">+</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in rank"</span>) <span class="sc">+</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="composite-figure" class="level1">
<h1>Composite figure</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="do">## PCA plot</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>pcomp1 <span class="ot">&lt;-</span> pPCA <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfPCA, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2, <span class="at">col=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">1</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(<span class="fu">attr</span>(pc, <span class="st">"percentVar"</span>)[<span class="dv">2</span>], <span class="dv">1</span>),<span class="st">"%)"</span>)) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">3</span>)))</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>pcomp2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lupusCountsLong, <span class="fu">aes</span>(<span class="at">x=</span>CLR, <span class="at">y=</span>celltype, <span class="at">fill=</span>SLE_status)) <span class="sc">+</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>pop_cov) <span class="sc">+</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cell type"</span>)  </span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>pcomp3 <span class="ot">&lt;-</span> pHeatVoomCLR <span class="sc">+</span></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>pcomp11 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pcomp1, pcomp3, <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"c"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pcomp11, pcomp2, <span class="at">labels=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="st">"b"</span>), <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_text()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/240112_lupusCase_mainFigure_bootstrap.pdf"</span>,</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">12</span>, <span class="at">height=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_text()`).</code></pre>
</div>
</div>
</section>
<section id="not-accounting-for-processing-cohort-using-voomclr" class="level1">
<h1>Not accounting for processing cohort using <code>voomCLR</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>patientAll <span class="ot">&lt;-</span> lupusMetaAll<span class="sc">$</span>ind_cov</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>designAll <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>SLE_status<span class="sc">*</span>pop_cov, <span class="at">data=</span>lupusMetaAll)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> <span class="cn">TRUE</span>, </span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voomCLR</span>(<span class="at">counts =</span> lupusCountMatAll,</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> designAll,</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">lib.size =</span> <span class="cn">NULL</span>,</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus, </span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">duplicateCorrelation</span>(v, designAll, <span class="at">block=</span>patientAll)</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll,</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">block =</span> patientAll,</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">correlation =</span> cf<span class="sc">$</span>consensus)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, designAll)</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span><span class="fu">ncol</span>(fit<span class="sc">$</span>coefficients), <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(L) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(fit<span class="sc">$</span>coefficients)</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(L) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Asian"</span>, <span class="st">"European"</span>, <span class="st">"Interaction"</span>)</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>L[<span class="st">"SLE_statusSLE"</span>,<span class="st">"Asian"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>L[<span class="fu">c</span>(<span class="st">"SLE_statusSLE"</span>, <span class="st">"SLE_statusSLE:pop_covEuropean"</span>),<span class="st">"European"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>L[<span class="st">"SLE_statusSLE:pop_covEuropean"</span>,<span class="st">"Interaction"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>conFit <span class="ot">&lt;-</span> <span class="fu">contrasts.fit</span>(fit,</span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contrasts =</span> L)</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plotBeta</span>(conFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>conFit <span class="ot">&lt;-</span> <span class="fu">eBayes</span>(conFit)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>ttList <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(L), <span class="cf">function</span>(xx){</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">topTableBC</span>(conFit, <span class="at">coef=</span>xx, <span class="at">number=</span><span class="cn">Inf</span>, </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">bootstrap=</span><span class="st">"parametric"</span>, <span class="at">voomWeights =</span> v<span class="sc">$</span>weights, <span class="at">contrastMatrix=</span>L[,xx,<span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ttList) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(L)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>ttList</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Asian
             logFC    AveExpr          t      P.Value    adj.P.Val
cM      0.85824756  2.4003730  4.4081799 1.379599e-05 0.0001517559
Prolif  0.93744456 -1.3857294  4.1665575 3.880040e-05 0.0002134022
ncM     0.72447581  0.4813234  3.3455805 9.080255e-04 0.0033294269
T8      0.42890689  2.2140739  2.2052886 2.806845e-02 0.0771882378
T4     -0.41269819  2.6602609 -2.0922098 3.712307e-02 0.0816707488
cDC     0.18848159 -0.4424735  1.1051490 2.698366e-01 0.4947004455
Progen -0.22109097 -3.5267006 -0.9469487 3.443031e-01 0.5215936684
PB     -0.19836869 -3.2854013 -0.8188007 4.134444e-01 0.5215936684
B       0.15178554  1.5533677  0.7956566 4.267585e-01 0.5215936684
pDC     0.06938379 -1.7545140  0.4056155 6.852672e-01 0.7537939688
NK     -0.04960526  1.0854200 -0.2652798 7.909465e-01 0.7909464508

$European
             logFC    AveExpr          t      P.Value    adj.P.Val
cM      0.60385796  2.4003730  5.8521556 1.096038e-08 1.205642e-07
pDC    -0.64772986 -1.7545140 -5.4338274 1.021131e-07 5.616222e-07
Prolif  0.57878233 -1.3857294  4.4572258 1.111945e-05 4.077133e-05
ncM     0.44620705  0.4813234  3.6938580 2.553308e-04 7.021596e-04
B      -0.41295616  1.5533677 -2.6099843 9.434469e-03 2.075583e-02
Progen  0.16341082 -3.5267006  1.4108624 1.591529e-01 2.917802e-01
T4     -0.12444371  2.6602609 -1.3048736 1.927733e-01 3.029295e-01
T8      0.10650648  2.2140739  1.1919550 2.340678e-01 3.218432e-01
PB     -0.12907277 -3.2854013 -0.9367991 3.494929e-01 4.271580e-01
NK      0.03081139  1.0854200  0.3202917 7.489339e-01 7.735800e-01
cDC    -0.02573893 -0.4424735 -0.2879127 7.735800e-01 7.735800e-01

$Interaction
             logFC    AveExpr           t     P.Value  adj.P.Val
T4      0.57709699  2.6602609  3.18002727 0.001600983 0.01761081
Progen  0.67334429 -3.5267006  2.63073871 0.008887731 0.04888252
pDC    -0.42827115 -1.7545140 -1.94968404 0.051993556 0.19064304
NK      0.36925915  1.0854200  1.62836988 0.104325428 0.28689493
PB      0.35813843 -3.2854013  1.34315280 0.180072665 0.39615986
B      -0.27589919  1.5533677 -1.05409388 0.292550251 0.53634213
cDC     0.07462199 -0.4424735  0.47023259 0.638474955 0.91580155
Prolif -0.06981972 -1.3857294 -0.36614473 0.714473185 0.91580155
cM      0.03445290  2.4003730  0.24232660 0.808665754 0.91580155
T8     -0.03355791  2.2140739 -0.21159046 0.832546859 0.91580155
ncM     0.01057374  0.4813234  0.06452611 0.948587302 0.94858730</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>resDfAll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">population =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttList, rownames)),</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">contrast =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Asian"</span>, <span class="st">"European"</span>, <span class="st">"Interaction"</span>), <span class="at">each=</span>nPopulations),</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">log2FC =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttList, <span class="cf">function</span>(x) x<span class="sc">$</span>logFC)),</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">padj =</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(ttList, <span class="cf">function</span>(x) x<span class="sc">$</span>adj.P.Val))</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>resDfAll<span class="sc">$</span>DA <span class="ot">&lt;-</span> resDfAll<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.1</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>pHeatVoomCLR_noProcessingCohort <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resDfAll, </span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>contrast, <span class="at">y=</span>population, <span class="at">color=</span>log2FC, <span class="at">size=</span>DA)) <span class="sc">+</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low=</span> <span class="st">"blue"</span>, <span class="at">mid=</span><span class="st">"gray"</span>, <span class="at">high=</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">angle=</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Contrast"</span>) <span class="sc">+</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cell type"</span>) <span class="sc">+</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"No processing cohort: significance at 10% FDR"</span>)</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>pHeatVoomCLR_noProcessingCohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="240112_lupusCaseStudy_v2_parametricBootstrap_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../plots/240126_lupusCase_noProcessingCohort_voomCLR_10FDR_parametricBootstrap.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>